{
    "restart_log" : true,
    "engine" : {
        "type" : "sim",
        "start_time" : "-P30D",
        "end_time" : null
    },
    "events" : [
        {
            "comment" : "notification testing",
            "action" : {
                "create_device" : {
                    "functions" : {
                        "variable" : [
                            { "name" : "sinewave", "timefunction" : { "sinewave" : { "period" : "PT15M" } } },
                            { "name" : "device_type", "value" : "test" }
                        ]
                    }
                }
            }
        },
        {
            "comment" : "drug fridges",
            "action" : {
                "use_model" : [
                    { "hierarchy" : "hospital/building/fridge" },
                    { "model" : { } , "properties" : { "demo" : "drug fridges" } },
                    { "model" : { "hospital" : "Addenbrookes" }, "devices" : [ {"weather":{}} ], "properties" : { "latitude" : 52.1730311, "longitude" : 0.1393937}},
                    { "model" : { "hospital" : "Addenbrookes", "building" : "[('Harper','Florence','Whittaker','MRC','NIHR','Crick','Lavellier')]", "fridge" : "Fridge #25#"},
                        "devices" : [
                            {
                                "disruptive" : { "sensor_type" : "temperature", "nominal_temp" : [-30,-18,5,20], "nominal_temp_deviation" : [2,2,3,8], "site_type" : ["ultra-freezer", "freezer", "fridge", "ambient"] }
                            },
                            {
                                "disruptive" : { "sensor_type" : "proximity" }
                            }
                        ],
                        "properties" : {
                                "$x" : "0..848",
                                "$y" : "0..651"
                        }
                    }
                ]
            }
        },
        {
            "comment" : "vending machines",
            "repeats" : 20,
            "action": {
                "create_device" : {
                    "functions" : {
                        "firmware" : {},
                        "latlong" : {
                            "generate_addresses" : true,
                            "area_centre" : "Stockton, Kansas, USA",
                            "area_radius" : "Key Largo, USA"
                        },
                        "vending_machine" : {},
                        "variable" : {"name" : "device_type", "value" : "vending_machine"}
                    }
                }
            }
        },
        {
            "comment" : "sump pumps in Holland",
            "repeats" : 10,
            "action": {
            	"create_device" : {
                    "functions" : {
                        "firmware" : {},
                        "latlong" : { "generate_addresses" : true, "area_centre" : "Nijmegen, Holland", "area_radius" : "Arnhem, Holland" },
                        "weather" : {},
                        "pump" : {},
                        "variable" : {"name" : "device_type", "value" : "sump_pump"}
                    }
                }
            }
        },
        {
            "comment" : "sump pumps in Cardiff",
            "repeats" : 10,
            "action": {
            	"create_device" : {
                    "functions" : {
                        "firmware" : {},
                        "latlong" : { "generate_addresses" : true, "area_centre" : "Cardiff, UK", "area_radius" : "Newport, Wales, UK" },
                        "weather" : {},
                        "pump" : {},
                        "variable" : {"name" : "device_type", "value" : "sump_pump"}
                    }
                }
            }
        },
        {
            "comment" : "mobile pallets in the UK",
            "repeats" : 100,
            "action": {
                "create_device" : {
                    "functions" : {
                        "battery" : {
                            "life_mu" : "P90D",
                            "life_sigma" : "P30D",
                            "autoreplace" : true,
                            "autoreplace_delay" : "P7D"
                        },
                        "mobile" : {
                            "area_centre" : "Rugby, UK",
                            "area_radius" : "Boston, UK"
                        },
                        "variable" : [
                            {
                                "name" : "temperature",
                                "timefunction" : {
                                    "sinewave" : {
                                        "period" : ["PT7M", "PT13M", "PT17M", "PT23M", "PT37M", "PT3H", "PT13H", "PT27H", "P3D", "P7D", "P13D"],
                                        "overall_amplitude" : 15.0,
                                        "overall_offset" : -3.5,
                                        "sample_period" : "PT3H",
                                        "randomise_phase_by" : "$id",
                                        "precision" : 10
                                    }
                                }
                            },
                            {
                                "name" : "event",
                                "timefunction" : {
                                    "events" : {
                                        "interval" : "P30D",
                                        "value" : "1G_shock_detected"
                                    }
                                }
                            },
                            {	"name" : "device_type", "value" : "pallet"}
                        ]
                    }
                }
            }
        },
        {
            "comment" : "BMS - smoke detectors",
            "repeats" : 50,
            "action": {
                "create_device" : {
                    "functions" : {
                        "basic" : {
                            "label_root" : "Smoke Detector "
                        },
                        "battery" : {
                            "life_mu" : "P360D",
                            "life_sigma" : "P120D",
                            "autoreplace" : true,
                            "autoreplace_delay" : "P14D"
                        },
                        "comms" : {
                            "reliability" : "rssi",
                            "period" : "PT1H",
                            "suppress_messages" : true
                        },
                        "enumerated" : {
                            "name" : "event",
                            "values" :  ["heartbeat", "alarm", "battery low", "mains loss", "cover removed", "hardware fault", "calibration error", "sensor needs cleaning", "internal fault", "link interference", "over-temperature"],
                            "periods" : ["PT1H",      "P30D",  "P20D",        "P20D",       "P15D",          "P60D",           "P100D",             "P20D",                  "P50D",           "P23D",              "P50D"],
                            "sigmas" :  ["PT0S",      "P10D",  "P8D",         "P8D",        "P5D",           "P20D",           "P33D",              "P8D",                   "P18D",           "P8D",               "P18D"]
                        },
                        "variable" : [
                            { "name" : "demo", "value" : "BMS" },
                            { "name" : "device_type", "value" : "smoke_alarm" },
                            { "name" : "hardware_version", "value" : [0.4,0.6,0.9,1.1,1.5] },
                            { "name" : "$x", "value" : [1000,1500,2000,2500,3000,3500,4000,4500,5000,5500,6000,6500] },
                            { "name" : "$y", "value" : [1000,1250,1500,1750,2000,2250,2500,2750,3000] },
                            { "name" : "latitude" , "value" : 37.386051}, { "name" : "longitude", "value" : -122.083855}  //  Mountain View, California 
                        ]
                    }
                }
            }
        },
        { 
           "comment" : "BMS - PV array",
            "repeats" : 8,
            "action" : {
                "create_device" : {
                    "functions" : {
                        "light" : { "clouds" : true, "generate" : true },
                        "variable" : [
                            { "name" : "demo", "value" : "BMS" },
                            { "name" : "device_type", "value" : "pv_array" },
                            { "name" : "latitude" , "value" : 37.386051}, { "name" : "longitude", "value" : -122.083855}  //  Mountain View, California 
                        ]
                    }
                }
            }
        },
        { 
            "comment" : "BMS - weather sensor",
            "repeats" : 1,
            "action" : {
                "create_device" : {
                    "functions" : {
                        "weather" : {},
                        "variable" : [
                            { "name" : "demo", "value" : "BMS" },
                            { "name" : "device_type", "value" : "weather_sensor" },
                            { "name" : "latitude" , "value" : 37.386051}, { "name" : "longitude", "value" : -122.083855}  //  Mountain View, California 
                        ]
                    }
                }
            }
        },
        {
            "comment" : "BMS - light bulbs",
            "repeats" : 10,
            "action" : {
                "create_device" : {
                    "functions" : {
                        "bulb" : { "power" : [12,20,36]},
                        "variable" : [
                            { "name" : "demo", "value" : "BMS" },
                            { "name" : "device_type", "value" : "bulb" },
                            { "name" : "$x", "value" : [100,150,200,250,300,350,400,450,500,550,600,650] },
                            { "name" : "$y", "value" : [100,125,150,175,200,225,250,275,300] },
                            { "name" : "latitude" , "value" : 37.386051}, { "name" : "longitude", "value" : -122.083855}  //  Mountain View, California 
                        ]
                    }
                }
            }
        },
        {
            "comment" : "Solar PV array in Poland",
            "repeats" : 10,
            "action" : {
                "create_device" : {
                    "functions" : {
                        "light" : { "clouds" : true, "generate" : true, "generate_scalar" : 2 },
                        "latlong" : { "generate_addresses" : true, "area_centre" : "Warsaw, Poland", "area_radius" : "Plonsk, Poland" },
                        "variable" : { "name" : "device_type", "value" : "pv_array"}
                    }
                }
            }
        },
        {
            "comment" : "SMART METERS across India,where one vendor has a problem",
            "repeats" : 50,
            "action": {
                "create_device" : {
                    "functions" : {
                        "basic" : {
                            "label_root" : "Meter "
                        },
                        "commswave" : {
                            "threshold" : 0.01, // To give 99% uptime
                            "timefunction" : {
                                "randomwave" : {
                                    "period" : "PT1H",
                                    "precision" : 100
                               }
                            }
                         },
                        "enumerated" : {
                            "name" : "fault",
                            "values" : ["tamper", "mains loss", "cover removed", "hardware fault", "calibration error", "internal fault", "link interference", "over-temperature"],
                            "periods" : ["P30D",  "P20D",       "P15D",          "P60D",           "P100D",              "P50D",           "P23D",              "P50D"],
                            "sigmas" : ["P10D",   "P7D",        "P5D",           "P20D",           "P30D",               "P16D",           "P8D",               "P16D"]
                        },
                        "firmware" : {},
                        "latlong" : {
                            "generate_addresses" : true,
                            "area_centre" : "Nagpur, India",
                            "area_radius" : "Jodhpur, India"
                        },
                        "variable" : [
                            {   "name" : "vendor",  "value" : ["Landis & Gyr", "EDMI", "Aclara", "Itron", "Kaifa", "Honeywell", "Flonidan", "GWI"]},
                            {   "name" : "model",   "value" : ["E470-5394", "ES-10A", "SGM1412", "EM425-I2", "MA120", "AS203P", "BK-G4E", "E470", "G4-MG-SE"]},
                            {	"name" : "device_type", "value" : "smart_meter"},
                            {   "name" : "energy", "timefunction" : { "count" : { "interval" : "PT1H" } } }
                        ]
                    }
                }
            }
        },
        {
            "comment" : "Mobile trucks in LA",
            "at" : "PT0S",
            "repeats" : 50,
            "interval" : "PT0S",
            "action": {
                "create_device" : {
                    "functions" : {
                        "basic" : {
                            "label_root" : "Vehicle ",
                            "use_label_as_$id" : true
                        },
                        "mobile" : {
                            "area_centre" : "Anaheim, Los Angeles, CA, USA",
                            "area_radius" : "San Diego, CA, USA",
                            "generate_fleet_management_metrics" : true,
                            "dwell_h_min" : 1,
                            "dwell_h_max" : 48
                        },
                        "enumerated" : {
                            "name" : "fault",
                            "values" : ["engine overheat", "flat battery", "fuel trouble", "flat tire", "no fault"],    // Last entry clears all faults within 24 hours
                            "periods" : ["P80D",           "P70D",         "P80D",         "P45D",      "P1D"],
                            "sigmas"  : ["P40D",           "P45D",         "P40D",         "P22D",      "PT0S"]
                        },
                        "variable" : [
                            {
                                "name" : "device_type", "value" : "mobile trucks",
                                "name" : "temperature_F",
                                "timefunction" : {
                                    "sinewave" : {
                                        "period" : ["PT7M", "PT13M", "PT17M", "PT23M", "PT37M", "PT3H", "PT13H", "PT27H", "P3D", "P7D", "P13D"],
                                        "overall_amplitude" : 25.0,
                                        "overall_offset" : 66,
                                        "sample_period" : "PT3H",
                                        "randomise_phase_by" : "$id",
                                        "precision" : 10
                                    }
                                }
                            },
                            {
                                "name" : "event",
                                "timefunction" : {
                                    "events" : {
                                        "interval" : "P60D",
                                        "value" : "1G_shock_detected"
                                    }
                                }
                            }
                        ]
                    }
                }
            }
        },
        { 
            "comment" : "Commercial refrigerators in Germany with HACCP monitoring",
            "action" : {
                "use_model" : [
                    { "hierarchy" : "site/fridge" },
                    { "model" : {}, "properties" : { "demo" : "haccp" } },
                    { "model" : { "site" : "Site #10#" } , "properties" : { "latlong" : { "area_centre" :  "Eisenach, Germany", "area_radius" : "Aachen, Germany", "generate_addresses" : true  } } },
                    { "model" : { "site" : "Site #10#" } , "properties" : { "store_manager_email" : "[('Lucas','Max','Oskar','Moritz','Anton','Mia','Emma','Sofia','Johanna','Klara'),'.',('MÃ¼ller','Schmidt','Schneider','Fischer','Weber'),'@bechstraubel.de']" } },
                    { "model" : { "site" : "Site #10#", "fridge" : "Fridge #4#" } , "devices" : [ { "disruptive" : { "sensor_type" : "temperature", "nominal_temp" : [-18,5], "nominal_temp_deviation" : [2,3], "site_type" : ["freezer", "fridge"], "cooling_mtbf" : "P100D", "cooling_ttf" : "P3D" }} ] }
                ]
            }
        },
        {
            "comment" : "energy and occupancy in buildings",
            "action" : {
                "use_model" : [
                    { "comment" : "x,y coordinates in Cambridge match this floorplan: https://mir-s3-cdn-cf.behance.net/project_modules/fs/284b1728142003.563704a2ac3db.jpg"},
                    { "hierarchy" : "customer/site/floor/zone" },
                    { "model" : {}, "properties" : { "demo" : "energy in buildings" } },
                    { "model" : { "customer" : "Boots" },                                                                       "functions" : [ "opening_hours" ] },
                    { "model" : { "customer" : "Boots", "site" : "Cambridge" },                                                 "properties" : { "latitude" : 52.206839, "longitude" : 0.120750 } },
                    { "model" : { "customer" : "Boots", "site" : "Cambridge" },                                                 "devices" : [ {"aggregate" : { "numbers" : ["kW", "temperature"], "booleans" : ["occupied"]} } ] },
                    { "model" : { "customer" : "Boots", "site" : "Cambridge"},                                                  "devices" : [ {"weather" : {}} , { "energy" : { "opening_times" : "nine_to_five"}} ] },
                    { "model" : { "customer" : "Boots", "site" : "Cambridge", "floor" : "Ground Floor", "zone" : "Admin"  },    "devices" : [ {"occupancy" : { "times" : "nine_to_five"}, "co2" : {}, 
                        "variable" : [ { "name" : "$x", "series" : [805, 832, 600, 808, 820]}, { "name" : "$y", "series" : [697, 154, 793, 630, 485] }]}], "count" : 5} ,
                    { "model" : { "customer" : "Boots", "site" : "Cambridge", "floor" : "Ground Floor", "zone" : "Admin"  },    "devices" : [ {"co2" : {}}]} ,
                    { "model" : { "customer" : "Boots", "site" : "Cambridge", "floor" : "Ground Floor", "zone" : "Retail" },    "devices" : [ {"occupancy" : {}, "co2" : {},
                        "variable" : [ { "name" : "$x", "series" : [1168, 814, 1099]}, {"name" : "$y", "series" : [355, 563, 610] }]}], "count" : 3 },
                    { "model" : { "customer" : "Boots", "site" : "Cambridge", "floor" : "Ground Floor", "zone" : "Storage" },   "devices" : [ {"occupancy" : {}, "co2" : {}, "variable": [{"name":"$x","value":1237},{"name":"$y","value":116}]}  ] },
                    { "model" : { "customer" : "Boots", "site" : "Cambridge", "floor" : "First Floor",  "zone" : "Retail" },    "devices" : [ {"occupancy" : {}, "co2" : {},
                        "variable" : [ { "name" : "$x", "series" : [789, 835, 831]}, { "name" : "$y", "series" : [782, 303, 399]}]}], "count" : 3 },
                                 { "model" : { "customer" : "Boots", "site" : "Cambridge", "floor" : "First Floor",  "zone" : "Maintenance" }, "devices" : [ {"occupancy" : {} , "co2" : {}, "variable" : [{"name":"$x","value":520}, {"name":"$y","value":714}]}]  },
                
                    { "model" : { "customer" : "Boots", "site" : "Oxford" },                                                    "properties" : { "latitude" : 51.752814, "longitude" : -1.257859 } },
                    { "model" : { "customer" : "Boots", "site" : "Oxford" },                                                    "devices" : [ {"weather" : {}}, {"energy" : { "opening_times" : "eight_to_six"}} ] },
                    { "model" : { "customer" : "Boots", "site" : "Oxford" },                                                    "devices" : [ {"aggregate" : { "numbers" : ["kW", "temperature"], "booleans" : ["occupied"]} } ] },
                    { "model" : { "customer" : "Boots", "site" : "Oxford", "floor" : "Ground Floor", "zone" : "Office" },       "devices" : [ {"occupancy" : {}, "co2" : {}} ], "count" : 3},
                                 { "model" : { "customer" : "Boots", "site" : "Oxford", "floor" : "Ground Floor", "zone" : "Retail" },       "devices" : [ {"occupancy" : {}, "co2" : {}} ], "count" : 8},
                    { "model" : { "customer" : "Boots", "site" : "Oxford", "floor" : "First Floor", "zone" : "Retail" },        "devices" : [ {"occupancy" : {}, "co2" : {}} ], "count" : 5},

                    { "model" : { "customer" : "Boots", "site" : "London, Piccadilly" },                                                    "properties" : { "latitude": 51.507630, "longitude" : -0.141915 } },
                    { "model" : { "customer" : "Boots", "site" : "London, Piccadilly" },                                                    "devices" : [ {"weather" : {}} , { "energy" : { "opening_times" : "six_day"}} ] },
                    { "model" : { "customer" : "Boots", "site" : "London, Piccadilly" },                                                    "devices" : [ {"aggregate" : { "numbers" : ["kW", "temperature"], "booleans" : ["occupied"]} } ] },
                    { "model" : { "customer" : "Boots", "site" : "London, Piccadilly", "floor" : "Ground Floor", "zone" : "Retail" },       "devices" : [ { "occupancy" : { "times" : "six_day"}, "co2" : {}}], "count" : 6 },
                    { "model" : { "customer" : "Boots", "site" : "London, Piccadilly", "floor" : "First Floor", "zone" : "Retail" },        "devices" : [ { "occupancy" : { "times" : "six_day"}, "co2" : {}}], "count" : 5 },
                    { "model" : { "customer" : "Boots", "site" : "London, Piccadilly", "floor" : "Second Floor", "zone" : "Retail" },       "devices" : [ { "occupancy" : { "times" : "six_day"}, "co2" : {}}], "count" : 3 },
                    { "model" : { "customer" : "Boots", "site" : "London, Piccadilly", "floor" : "Second Floor", "zone" : "Admin" },        "devices" : [ { "occupancy" : { "times" : "nine_to_five"}, "co2" : {}}] },
                
                    { "model" : { "customer" : "Boots", "site" : "Southampton"},                                                            "properties" : { "latitude": 50.910847, "longitude" : -1.410974 } },
                    { "model" : { "customer" : "Boots", "site" : "Southampton"},                                                            "devices" : [ {"weather" : {}} , { "energy" : { "opening_times" : "nine_to_five"}} ] },
                    { "model" : { "customer" : "Boots", "site" : "Southampton"},                                                            "devices" : [ {"aggregate" : { "numbers" : ["kW", "temperature"], "booleans" : ["occupied"]} } ] },
                    { "model" : { "customer" : "Boots", "site" : "Southampton", "floor" : "Ground Floor", "zone" : "Retail" },              "devices" : [ { "occupancy" : {}, "co2" : {}}], "count" : 3 },
                
                    { "model" : { "customer" : "Boots", "site" : "Edinburgh, Princes St"},                                                  "properties" : { "latitude": 55.951709, "longitude" : -3.200539 } },
                    { "model" : { "customer" : "Boots", "site" : "Edinburgh, Princes St"},                                                  "devices" : [ {"aggregate" : { "numbers" : ["kW", "temperature"], "booleans" : ["occupied"]} } ] },
                    { "model" : { "customer" : "Boots", "site" : "Edinburgh, Princes St", "floor" : "Ground Floor", "zone" : "Retail" },    "devices" : [ { "occupancy" : {}, "co2" : {}}], "count" : 2},
                
                    { "model" : { "customer" : "Marks and Spencer", "site" : "Birmingham, Bath Row"},                                       "properties" : { "latitude" : 52.472919, "longitude" : -1.912178}},
                    { "model" : { "customer" : "Marks and Spencer", "site" : "Birmingham, Bath Row"},                                       "devices" : [ {"aggregate" : { "numbers" : ["kW", "temperature"], "booleans" : ["occupied"]} } ] },
                    { "model" : { "customer" : "Marks and Spencer", "site" : "Birmingham, Bath Row"},                                       "devices" : [ {"weather" : {}} , { "energy" : { "opening_times" : "nine_to_five"}} ] },
                    { "model" : { "customer" : "Marks and Spencer", "site" : "Birmingham, Bath Row", "floor" : "Ground Floor", "zone" : "Retail" }, "devices" : [ { "occupancy" : {}, "co2" : {} } ], "count" : 2},
                
                    { "model" : { "customer" : "Marks and Spencer", "site" : "Leeds, Turk's Head Yard"},                                    "properties" : { "latitude" : 53.797149, "longitude" : -1.542778}},
                    { "model" : { "customer" : "Marks and Spencer", "site" : "Leeds, Turk's Head Yard"},                                    "devices" : [ {"aggregate" : { "numbers" : ["kW", "temperature"], "booleans" : ["occupied"]} } ] },
                    { "model" : { "customer" : "Marks and Spencer", "site" : "Leeds, Turk's Head Yard"},                                    "devices" : [ {"weather" : {}} , { "energy" : { "opening_times" : "nine_to_five"}} ] },
                    { "model" : { "customer" : "Marks and Spencer", "site" : "Leeds, Turk's Head Yard", "floor" : "Ground Floor", "zone" : "Retail" }, "devices" : [ { "occupancy" : {}, "co2" : {} } ], "count" : 2},
                
                    { "model" : { "customer" : "Marks and Spencer", "site" : "Hitchin"},                                                    "properties" : { "latitude" : 51.949257, "longitude" : -0.277516}},
                    { "model" : { "customer" : "Marks and Spencer", "site" : "Hitchin"},                                                    "devices" : [ {"aggregate" : { "numbers" : ["kW", "temperature"], "booleans" : ["occupied"]} } ] },
                    { "model" : { "customer" : "Marks and Spencer", "site" : "Hitchin"},                                                    "devices" : [ {"weather" : {}} , { "energy" : { "opening_times" : "eight_to_six"}} ] },
                    { "model" : { "customer" : "Marks and Spencer", "site" : "Hitchin", "floor" : "Ground Floor", "zone" : "Retail" }, "devices" : [ { "occupancy" : {}, "co2" : {} } ], "count" : 3}
                ]
            }
        },
        {
            "comment" : "Inject a problem later into one brand of meters",
            "at" : "P7D",
             "action": {
                "change_property" : {
                    "is_attribute" : true,
                    "identity_property" : "vendor",
                    "identity_value" : "Itron",
                    "property_name" : "comms_tf_threshold",
                    "property_value" : 0.20 // Change uptime to 80%
                }
            }
        }
    ]
}

